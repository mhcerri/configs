#!/bin/bash
#
# Load layout files that match "~/.i3/workspace-${WS}.json", where
# ${WS} is a workspace name (ie "2" or "10").
#
# The json files should follow the format accepted by append_layout
# and can be generated by `save-tree > ~/.i3/workspace-${WS}.json`. And
# they should be edited accordingly.
#
# Special comments in those files starting with //! are used as
# commands to be executed after the layout is loaded.
#
I3_DIR=~/.i3

IFS=$'\n'
for json in $(find $(readlink -f "$I3_DIR") -name 'workspace-*.json'); do
	ws="${json#*/workspace-}"
	ws="${ws%.json}"
	# Load layout
	if ! i3-msg "workspace \"$ws\"; append_layout \"$json\""; then
		echo "Failed to load workspace \"$ws\"."
		continue
	fi
	sed -n 's|^//!||p' "$json" |
		while read cmd; do
			echo "Starting: $cmd"
			(eval "$cmd")&
		done
done
